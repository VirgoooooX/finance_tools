# 财务数据清洗与分析工具 (Finance Tools)

一个强大的 Python 脚本，用于批量处理、清洗和分析 Excel 格式的财务报表数据。

## ✨ 核心功能

### 📊 数据清洗
- ✅ 自动识别并处理当前目录下所有 `.xlsx` 文件
- ✅ 智能识别包含 **BS**（资产负债表）、**PL**（利润表）、**CF**（现金流量表）的所有工作表
- ✅ 支持多种日期格式（Excel数字、中文格式、标准日期）
- ✅ 自动处理左右分栏格式的报表
- ✅ 生成标准化的长表格式，便于数据分析

### 🔍 数据验证
- ✅ **会计恒等式验证**：自动验证 `资产 = 负债 + 所有者权益`
- ✅ 设置容差阈值（0.01元）
- ✅ 标记不平衡记录，生成验证报告

### 📈 财务指标计算（16项）

#### 流动性指标
- 流动比率
- 速动比率
- 现金比率

#### 偿债能力指标
- 资产负债率
- 产权比率
- 权益乘数

#### 盈利能力指标
- 毛利率
- 营业利润率
- 净利率
- ROE（净资产收益率）
- ROA（总资产收益率）

#### 现金流指标
- 经营活动现金流净额
- 投资活动现金流净额
- 筹资活动现金流净额
- 现金流量比率

## 🚀 快速开始

### 环境要求
```bash
pip install pandas openpyxl
```

### 使用方法
1. 将脚本 `202601011958.py` 放置在包含 Excel 财务报表的目录中
2. 运行脚本：
```bash
python 202601011958.py
```

### 输出文件
脚本会生成 3 个 Excel 文件：

1. **清洗后的AI标准财务表.xlsx** - 标准化的原始数据
2. **清洗后的AI标准财务表_验证报告.xlsx** - 会计恒等式验证结果
3. **清洗后的AI标准财务表_财务指标.xlsx** - 自动计算的财务指标汇总

## 📋 数据格式要求

### Excel 文件结构
- 文件扩展名：`.xlsx`
- 工作表命名：包含 `BS`、`PL` 或 `CF` 关键字（大小写不敏感）

### 支持的报表格式
- **资产负债表**：左右分栏（左侧资产，右侧负债及权益）
- **利润表**：标准格式（科目、本期金额、本年累计金额）
- **现金流量表**：左右分栏（可选）

## 🎯 适用场景

- ✅ 批量处理多个公司的财务报表
- ✅ 定期生成财务分析报告
- ✅ 数据质量审核与合规检查
- ✅ 财务指标趋势分析
- ✅ AI/机器学习的数据预处理

## 💡 特色功能

### 智能科目识别
使用模糊匹配技术，自动识别不同命名方式的科目：
- "资产总计" / "资产总额" / "资产合计"
- "货币资金" / "现金及现金等价物"
- 支持自定义扩展

### 自动分组分析
按以下维度自动分组：
- 📁 源文件
- 📋 来源Sheet
- 📅 日期
- ⏰ 时间属性（期末/年初/本期/累计）

### 详细日志输出
- 显示处理进度
- 标记验证失败的记录
- 预览关键财务指标

## 📊 输出数据结构

### 原始数据表
| 源文件 | 来源Sheet | 日期 | 报表类型 | 大类 | 科目 | 时间属性 | 金额 |
|--------|-----------|------|----------|------|------|----------|------|

### 验证报告表
| 源文件 | 来源Sheet | 日期 | 时间属性 | 资产总计 | 负债合计 | 所有者权益合计 | 差额 | 是否平衡 | 验证结果 |
|--------|-----------|------|----------|----------|----------|----------------|------|----------|----------|

### 财务指标表
| 源文件 | 来源Sheet | 日期 | 时间属性 | 流动比率 | 资产负债率 | 毛利率 | 净利率 | ROE | ... |
|--------|-----------|------|----------|----------|------------|--------|--------|-----|-----|

## 🔧 配置选项

在脚本顶部可以修改以下配置：
```python
OUTPUT_PATH = '清洗后的AI标准财务表.xlsx'  # 输出文件名
```

## 📝 示例输出

```
找到 3 个Excel文件:
  - 工作簿1.xlsx
  - 工作簿2.xlsx
  - 工作簿3.xlsx

==================================================
正在处理文件: 工作簿1.xlsx
==================================================
发现 5 个Sheet: ['BS-合并', 'PL-合并', 'CF-合并', 'Sheet1', 'Sheet2']
  - 资产负债表(BS)相关: ['BS-合并']
  - 利润表(PL)相关: ['PL-合并']
  - 现金流量表(CF)相关: ['CF-合并']
✅ 工作簿1.xlsx 处理完成，提取 856 行数据

==================================================
📊 开始数据验证与财务指标计算...
==================================================
✅ 原始数据已保存: 清洗后的AI标准财务表.xlsx
✅ 验证报告已保存: 清洗后的AI标准财务表_验证报告.xlsx
✅ 所有资产负债表均通过会计恒等式验证！
✅ 财务指标已保存: 清洗后的AI标准财务表_财务指标.xlsx

==================================================
✅ 所有处理完成！
==================================================
📁 共处理 3 个Excel文件
📊 合并 2568 行原始数据
📈 生成 36 组财务指标
🔍 验证 18 组资产负债表数据
```

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 👨‍💻 作者

VirgoooooX

---

⭐ 如果觉得有用，请给个 Star！
